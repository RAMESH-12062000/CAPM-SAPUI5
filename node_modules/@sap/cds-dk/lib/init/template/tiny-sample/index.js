const { join } = require('path')
const cds = require('../../../../lib/cds'), { copy } = cds.utils
const { renderAndCopy } = require('../../template')
const mvn = require('../../mvn')
const { env4, readProject } = require('../../projectReader')
const { JAVA } = require('../../constants')

module.exports = class TinySampleTemplate extends require('../../plugin') {

    async run() {
        const { isJava } = readProject()
        if (isJava) {
            if (!cds.cli.options.add.has(JAVA)) {
                await mvn.execMvn(mvn.getAddSamplesCmdArgs())
                await mvn.execMvn(mvn.getAddTestsCmdArgs())
            }
        } else {
            const { db, srv } = env4('production').folders
            await Promise.all([
                copy(join(__dirname, 'files', 'nodejs', 'db')).to(db),
                renderAndCopy(join(__dirname, 'files', 'nodejs', 'srv'), srv, { dbFolder: db.replace(/[\\/]+$/, '') })
            ])
        }
    }
}
