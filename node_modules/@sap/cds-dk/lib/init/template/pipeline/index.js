const { join } = require('path');
const cds = require('../../../cds')
const { exists, copy } = cds.utils
const { URLS } = require('../../constants')

module.exports = class PipelineTemplate extends require('../../plugin') {

    async canRun() {
        if (cds.cli.options.force) {
            return true;
        }

        if (exists('Jenkinsfile') || exists(join('.pipeline', 'config.yml'))) {
            throw `Pipeline support file exists. Use --force to overwrite.`
        }

        return true;
    }

    async run() {
        await copy(join(__dirname, 'files')).to(cds.root)
    }

    async finalize() {
        console.log(`For information on project "Piper" and its pipelines see ${URLS.PIPELINE_HELP}`);
    }
}
