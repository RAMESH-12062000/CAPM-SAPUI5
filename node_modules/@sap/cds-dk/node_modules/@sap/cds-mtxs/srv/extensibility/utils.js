const { path, tar, read, readdir } = cds.utils

const readData = async function (extension, root) {
    await tar.xvz(extension).to(root)

    let extCsn = {}
    try { extCsn = JSON.parse(await read(path.join(root, 'extension.csn'))) }
    catch(e) { if (e.code !== 'ENOENT') throw e }

    let bundles
    try { bundles = await read(path.join(root, 'i18n', 'i18n.json')) }
    catch(e) { if (e.code !== 'ENOENT') throw e }

    let csvs = {}
    try {
      const flist = await readdir(path.join(root, 'data'))
      for(let file of flist) {
        const basename = path.basename(file)
        csvs[basename] = await read(path.join(root, 'data', file))
      }
    }
    catch(e) { if (e.code !== 'ENOENT') throw e }

    return { extCsn, bundles, csvs }
}

module.exports = { readData }