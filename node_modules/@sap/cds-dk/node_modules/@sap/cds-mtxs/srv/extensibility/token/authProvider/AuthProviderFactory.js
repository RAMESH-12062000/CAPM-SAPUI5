const ClientCredentialsAuthProvider = require('./ClientCredentialsAuthProvider');
const PasswordAuthProvider = require('./PasswordAuthProvider');
const RefreshTokenAuthProvider = require('./RefreshTokenAuthProvider');
const { assertDefined } = require('./util/SecretsUtil');

module.exports = class AuthProviderFactory {

    /**
     * Validates all data relevant to the determination of the grant type.
     */
    static #validate(credentials, query) {
        assertDefined('query', query);
        assertDefined('presence of refresh token or passcode or clientid', !!query.refresh_token || !!query.passcode || !!query.clientid);
    }

    static getAuthProvider(credentials, query) {
        AuthProviderFactory.#validate(credentials, query);
        return query.refresh_token
            ? new RefreshTokenAuthProvider(credentials, query)
            : query.passcode
                ? new PasswordAuthProvider(credentials, query)
                : new ClientCredentialsAuthProvider(credentials, query);
    }
}
