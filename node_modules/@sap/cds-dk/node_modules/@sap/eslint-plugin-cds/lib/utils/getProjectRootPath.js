/**
 * Searches for directory containing cds roots
 * @param {string} currentDir start here and search until root dir
 * @returns {string} dir containing cds roots (empty if not exists)
 */

const path = require('path')
const cds = require('@sap/cds')
const Cache = require('./Cache')

module.exports = (currentDir = '.') => {
  let dir = path.resolve(currentDir)
  while (dir !== path.resolve(dir, '..')) {
    // @ts-ignore
    cds.resolve.cache = {}
    // @ts-ignore
    const roots = cds.resolve('*', { root: dir })
    if (roots && roots.length > 0) {
      Cache.set(`roots:${dir}`, roots)
      return dir
    }
    dir = path.join(dir, '..')
  }
  return ''
}
