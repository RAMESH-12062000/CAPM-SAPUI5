/**
 * Simple cache to store model and any cds calls made in the rule creation
 * api to modify the model
 */
const cache = new Map()

module.exports = {
  has (key) {
    return cache.has(key)
  },
  set (key, value) {
    return cache.set(key, [value, Date.now()])
  },
  get (key) {
    return cache.get(key) ? cache.get(key)[0] : undefined
  },
  dump () {
    const dump = {}
    for (const [key, value] of cache.entries()) {
      const timestamp = new Date(value[1])
      dump[key] = { key, value: JSON.stringify(value[0]), timestamp }
    }
    return dump
  },
  remove (key) {
    if (cache.has(key)) {
      cache.delete(key)
    }
  },
  clear () {
    cache.clear()
  }
}
